!function(r){const n={container:"",init(){const t=this;t.container=r("#aiosrs-schema-settings, #aiosrs-pro-custom-fields"),r(document).ready(function(){r(".select2-class").select2();var s=["Site Meta","Post Meta (Basic Fields)"];if("custom-markup"===r("#bsf-aiosrs-schema-type").val())for(let e=0;e<s.length;e++)r('#bsf-aiosrs-custom-markup-custom-markup optgroup[label="'+s[e]+'"]').remove();var t=r("#custom-schema-schema-field").val();if(t)for(let e=0;e<s.length;e++)r("#custom-markup-"+t+'-custom-markup-connected optgroup[label="'+s[e]+'"]').remove()}),t.container.on("change","select.bsf-aiosrs-schema-meta-field",function(){var e=r(this),s=e.parent(),e=e.val(),t=s.find(".bsf-aiosrs-schema-custom-text-wrap"),t=("custom-text"===e?t.removeClass("bsf-hidden-field"):t.hasClass("bsf-hidden-field")||t.addClass("bsf-hidden-field"),s.find(".bsf-aiosrs-schema-fixed-text-wrap")),t=("fixed-text"===e?t.removeClass("bsf-hidden-field"):t.hasClass("bsf-hidden-field")||t.addClass("bsf-hidden-field"),s.find(".bsf-aiosrs-schema-specific-field-wrap"));"specific-field"===e?t.removeClass("bsf-hidden-field"):t.hasClass("bsf-hidden-field")||t.addClass("bsf-hidden-field")}),t.container.on("change",".bsf-aiosrs-schema-row-rating-type select.bsf-aiosrs-schema-meta-field",function(e){var s,t;e.preventDefault(),r(this).closest(".bsf-aiosrs-schema-table").find(".bsf-aiosrs-schema-row").css("display",""),"accept-user-rating"===r(this).val()&&(s=(e=r(this).closest(".bsf-aiosrs-schema-row").next(".bsf-aiosrs-schema-row")).find(".bsf-aiosrs-schema-meta-field").attr("name"),(t=jQuery(".bsf-aiosrs-review-schema-type").val())&&0<=s.indexOf("bsf-aiosrs-review["+t+"-review-count]")&&e.hide(),0<=s.indexOf("[review-count]"))&&e.hide()}),t.container.find("select.bsf-aiosrs-schema-meta-field").trigger("change"),r("select.bsf-aiosrs-schema-select2").each(function(e,s){t.init_target_rule_select2(s)}),t.container.on("click",".bsf-repeater-add-new-btn",function(e){e.preventDefault(),t.add_new_repeater(r(this)),t.prepare_event_schmea_fields()}),t.container.on("click",".bsf-repeater-close",function(e){e.preventDefault(),t.add_remove_repeater(r(this))}),t.schemaTypeDependency(),t.bindTooltip(),r("body").hasClass("post-type-aiosrs-schema")||t.field_validation()},field_validation(){r(".wpsp-custom-field-connect, .wpsp-field-close, .bsf-aiosrs-schema-meta-field, image-field-wrap, .aiosrs-pro-custom-field, .wpsp-custom-field-connect").on("click focus change",function(){r(".bsf-aiosrs-schema-type-wrap").each(function(e,s){let t=r(s).find(".wpsp-default-hidden-value").val();var a=r(s).parents(".bsf-aiosrs-schema-row-content").prev();if(void 0!==t)if(t=t.trim())if(r("body").hasClass("block-editor-page"))if(r(s).find(".wpsp-required-error-field").length)a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field");else{let e;switch(t){case"post_title":e=r(".editor-post-title__input").val();break;case"post_content":e=1<r("p.block-editor-rich-text__editable").text().length?r("p.block-editor-rich-text__editable").text():"";break;case"post_excerpt":e=r(".components-textarea-control__input").val();break;case"featured_img":e="Set featured image"===r(".editor-post-featured-image__toggle").text()?"":r(".components-responsive-wrapper__content").attr("src");break;default:a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field")}void 0!==e&&(""!==e?(a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field")):a.find(".required").length&&a.find("label").addClass("wpsp-required-error-field"))}else a.removeClass("wpsp-required-error-field"),a.find("label").removeClass("wpsp-required-error-field");else a.find(".required").length&&a.find("label").addClass("wpsp-required-error-field")})})},hide_review_count(){var e,s,t;r(this).closest(".bsf-aiosrs-schema-table").find(".bsf-aiosrs-schema-row").css("display",""),"accept-user-rating"===r(this).val()&&(s=(e=r(this).closest(".bsf-aiosrs-schema-row").next(".bsf-aiosrs-schema-row")).find(".bsf-aiosrs-schema-meta-field").attr("name"),(t=jQuery(".bsf-aiosrs-review-schema-type").val())&&0<=s.indexOf("bsf-aiosrs-review["+t+"-review-count]")&&e.hide(),0<=s.indexOf("[review-count]"))&&e.hide()},add_new_repeater(e){const t=this,s=e.closest(".bsf-aiosrs-schema-type-wrap"),a=s.find(".aiosrs-pro-repeater-table-wrap").length,i=s.find(".aiosrs-pro-repeater-table-wrap").first().clone();i.find(".bsf-aiosrs-schema-custom-text-wrap, .bsf-aiosrs-schema-specific-field-wrap").each(function(){r(this).hasClass("bsf-hidden-field")||r(this).addClass("bsf-hidden-field")}),i.find("select.bsf-aiosrs-schema-meta-field").each(function(){r(this).val("none");var e=void 0!==r(this).attr("name")?r(this).attr("name").replace("[0]","["+a+"]"):"",s=void 0!==r(this).attr("class")?r(this).attr("class").replace("-0-","-"+a+"-"):"",t=void 0!==r(this).attr("id")?r(this).attr("id").replace("-0-","-"+a+"-"):"";r(this).attr("name",e),r(this).attr("class",s),r(this).attr("id",t)}),i.find("input, textarea, select:not(.bsf-aiosrs-schema-meta-field)").each(function(){r(this).val("");var e=void 0!==r(this).attr("name")?r(this).attr("name").replace("[0]","["+a+"]"):"",s=void 0!==r(this).attr("class")?r(this).attr("class").replace("-0-","-"+a+"-"):"",t=void 0!==r(this).attr("id")?r(this).attr("id").replace("-0-","-"+a+"-"):"";r(this).attr("name",e),r(this).attr("class",s),r(this).attr("id",t)}),i.find("span.select2-container").each(function(){r(this).remove()}),i.insertBefore(e),i.find("select.bsf-aiosrs-schema-select2").each(function(e,s){t.init_target_rule_select2(s)}),n.init_date_time_fields()},add_remove_repeater(e){var s=e.closest(".bsf-aiosrs-schema-type-wrap");1<s.find("> .aiosrs-pro-repeater-table-wrap").length&&(e.closest(".aiosrs-pro-repeater-table-wrap").remove(),"aiosrs-pro-custom-fields"===this.container.attr("id"))&&s.find("> .aiosrs-pro-repeater-table-wrap").each(function(a,e){r(e).each(function(e,s){r(s).find("input, textarea, select:not(.bsf-aiosrs-schema-meta-field)").each(function(e,s){var t=void 0!==r(s).attr("name")?r(s).attr("name").replace(/\[\d+]/,"["+a+"]"):"";r(s).attr("name",t)})})})},bindTooltip(){r(".bsf-aiosrs-schema-heading-help").tooltip({content(){return r(this).prop("title")},tooltipClass:"bsf-aiosrs-schema-ui-tooltip",position:{my:"center top",at:"center bottom+10"},hide:{duration:200},show:{duration:200}})},schemaTypeDependency(){const s=this.container;this.container.on("change",'select[name="bsf-aiosrs-schema-type"]',function(){s.find(".bsf-aiosrs-schema-meta-wrap").css("display","none");var e=r(this).val();void 0!==e&&""!==e&&s.find("#bsf-"+e+"-schema-meta-wrap").css("display","")})},init_target_rule_select2(e){r(e).select2({placeholder:"Search Fields...",ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data(e){return{nonce_ajax:AIOSRS_Rating.specified_field,q:e.term,page:e.page,action:"bsf_get_specific_meta_fields"}},processResults(e){return{results:e}},cache:!0},minimumInputLength:2})},get_review_item_type_html(s){jQuery.post({url:ajaxurl,data:{action:"fetch_item_type_html",itemType:s,nonce:AIOSRS_Rating.security,post_id:jQuery("#post_ID").val()}}).done(function(e){r(".bsf-review-item-type-field").remove(),r(e).insertAfter(jQuery("#bsf-aiosrs-review-schema-type").parent().parent().closest("tr")),r("select.bsf-aiosrs-schema-select2").each(function(e,s){n.init_target_rule_select2(s)}),r(".bsf-aiosrs-review-"+s+"-rating").each(function(){var e,s,t;r(this).closest(".bsf-aiosrs-schema-table").find(".bsf-aiosrs-schema-row").css("display",""),"accept-user-rating"===r(this).val()&&(s=(e=r(this).closest(".bsf-aiosrs-schema-row").next(".bsf-aiosrs-schema-row")).find(".bsf-aiosrs-schema-meta-field").attr("name"),(t=jQuery(".bsf-aiosrs-review-schema-type").val())&&0<=s.indexOf("bsf-aiosrs-review["+t+"-review-count]")&&e.hide(),0<=s.indexOf("[review-count]"))&&e.hide()}),n.init_date_time_fields(),n.prepare_event_schmea_fields()}).fail(function(){})},prepare_event_schmea_fields(){r(".wpsp-dropdown-event-status, .wpsp-dropdown-bsf-aiosrs-event-event-status").change(function(){var e=r(this).parents(".bsf-aiosrs-schema-meta-wrap, .aiosrs-pro-meta-fields-wrap"),s=(e.find("td.wpsp-event-status-rescheduled, td.bsf-aiosrs-review-bsf-aiosrs-event-previous-date").hide(),this.value||(this.value="EventScheduled"),"EventRescheduled"===this.value&&e.find("td.wpsp-event-status-rescheduled, td.bsf-aiosrs-review-bsf-aiosrs-event-previous-date").show(),r(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").val());"EventMovedOnline"===this.value||"OfflineEventAttendanceMode"!==s?(e.find("td.wpsp-event-status-offline").hide(),e.find("td.wpsp-event-status-online").show(),e.find("td.wpsp-online-event-timezone").show(),e.find(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").val("OnlineEventAttendanceMode")):(e.find("td.wpsp-event-status-offline").show(),e.find("td.wpsp-event-status-online").hide(),e.find("td.wpsp-online-event-timezone").hide())}),r(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").change(function(){var e=r(this).parents(".bsf-aiosrs-schema-meta-wrap, .aiosrs-pro-meta-fields-wrap"),s=(e.find("td.wpsp-event-status-rescheduled").hide(),r(".wpsp-dropdown-event-status, .wpsp-dropdown-bsf-aiosrs-event-event-status").val());"EventMovedOnline"!==s&&(e.find("td.wpsp-event-status-offline").show(),e.find("td.wpsp-event-status-online").hide(),e.find("td.wpsp-online-event-timezone").hide()),"OfflineEventAttendanceMode"!==this.value&&(e.find("td.wpsp-event-status-offline").hide(),e.find("td.wpsp-event-status-online").show(),e.find("td.wpsp-online-event-timezone").show()),"MixedEventAttendanceMode"===this.value&&(e.find("td.wpsp-event-status-offline").show(),e.find("td.wpsp-event-status-online").show(),e.find("td.wpsp-online-event-timezone").show())}),r(".wpsp-dropdown-event-attendance-mode, .wpsp-dropdown-bsf-aiosrs-event-event-attendance-mode").trigger("change")},init_date_time_fields(){r(".wpsp-datetime-local-field, .wpsp-date-field, .wpsp-time-duration-field").each(function(){r(this).removeClass("hasDatepicker")});const t=".wpsp-date-published-date, .wpsp-datetime-local-event-start-date, .wpsp-date-start-date, .wpsp-datetime-local-start-date",a=".wpsp-date-modified-date, .wpsp-datetime-local-event-end-date, .wpsp-date-end-date, .wpsp-datetime-local-end-date";r(document).on("focus",".wpsp-time-duration-field",function(){r(this).timepicker({timeFormat:"HH:mm:ss",hourMin:0,hourMax:99,oneLine:!0,currentText:"Clear",onSelect(){{var s=this,t,t=(t=r(s).closest(".aiosrs-pro-custom-field-time-duration")).find(".time-duration-field");let e=r(s).val();e="PT"+(e=(e=e.replace(/:/,"H")).replace(/:/,"M"))+"S",t.val(e),(t=r(s).parents(".wpsp-local-fields")).find(".wpsp-default-hidden-value").val(e)}}})}),r(document).on("focus",".wpsp-datetime-local-field, .wpsp-date-field",function(){r(this).datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"hh:mm TT",changeMonth:!0,changeYear:!0,showOn:"focus",showButtonPanel:!0,closeText:"Done",currentText:"Clear",yearRange:"-100:+10",onClose(e,s){s="#"+s.id;jQuery(s).is(t)?r(a).datetimepicker("option","minDate",new Date(e)):jQuery(s).is(a)&&r(t).datetimepicker("option","maxDate",new Date(e)),jQuery(s).parents(".wpsp-local-fields").find(".wpsp-default-hidden-value").val(e)}})}),r.datepicker._gotoToday=function(e){r(e).datepicker("setDate","").datepicker("hide").blur()}}};r(function(){n.init(),r("body").hasClass("aiosrs-pro-setup")||n.init_date_time_fields()}),r(document).ready(function(){r(".aiosrs-pro-meta-fields-wrap").each(function(e,s){s=r(s).find(".wpsp-field-label");"Image License"===s.text().trim()&&s.attr("style","width:6%")}),r("#bsf-aiosrs-review-schema-type").change(function(){var e=r(this).val().trim();e?n.get_review_item_type_html(e):r(".bsf-review-item-type-field").remove()}),r("#bsf-aiosrs-review-schema-type").change(),n.prepare_event_schmea_fields()})}(jQuery);