!function(t){"use strict";function n(t){window.console&&window.console.log&&console.log(t)}function e(t,n,e){this.init(t,n,e)}function i(){this.rules=[]}t.extend(e.prototype,{init:function(t,n,e){this.controller=t,this.condition=n,this.value=e,this.rules=[],this.controls=[]},evalCondition:function(n,e,i,o,l){if("=="==this.condition)return o==l;if("!="==i)return o!=l;if("()"==i)return o(n,e,l);if("any"==i)return t.inArray(l,o)>-1;if("not-any"==i)return -1==t.inArray(l,o);else throw Error("Unknown condition:"+i)},checkCondition:function(t,e){if(!this.condition)return!0;var i=t.find(this.controller);0===i.size()&&e.log&&n("Evaling condition: Could not find controller input "+this.controller);var o=this.getControlValue(t,i);return e.log&&void 0===o&&n("Evaling condition: Could not exctract value from input "+this.controller),void 0!==o&&(o=this.normalizeValue(i,this.value,o),this.evalCondition(t,i,this.condition,this.value,o))},normalizeValue:function(t,n,e){return"number"==typeof n?parseFloat(e):e},getControlValue:function(t,n){return"radio"==n.attr("type")&&n.size()>1?n.filter(":checked").val():"checkbox"==n.attr("type")||"radio"==n.attr("type")?n.is(":checked"):n.val()},createRule:function(t,n,i){var o=new e(t,n,i);return this.rules.push(o),o},include:function(t){if(!t)throw Error("Must give an input selector");this.controls.push(t)},applyRule:function(e,i,o){l=void 0===o?this.checkCondition(e,i):o,i.log&&n("Applying rule on "+this.controller+"=="+this.value+" enforced:"+o+" result:"+l),i.log&&!this.controls.length&&n("Zero length controls slipped through");var l,r=i.show||function(t){t.show()},s=i.hide||function(t){t.hide()},c=t.map(this.controls,function(t,o){var l=e.find(t);return i.log&&0===l.size()&&n("Could not find element:"+t),l});l?(t(c).each(function(){i.log&&0===t(this).size()&&(n("Control selection is empty when showing"),n(this)),r(this)}),t(this.rules).each(function(){this.applyRule(e,i)})):(t(c).each(function(){i.log&&0===t(this).size()&&(n("Control selection is empty when hiding:"),n(this)),s(this)}),t(this.rules).each(function(){this.applyRule(e,i,!1)}))}}),t.extend(i.prototype,{createRule:function(t,n,i){var o=new e(t,n,i);return this.rules.push(o),o},applyRules:function(t,e){var i;for((e=e||{}).log&&n("Starting evaluation ruleset of "+this.rules.length+" rules"),i=0;i<this.rules.length;i++)this.rules[i].applyRule(t,e)},walk:function(){var n=[];return t(this.rules).each(function(){!function e(i){n.push(i),t(i.children).each(function(){e(this)})}(this)}),n},checkTargets:function(e,i){var o=0,l=this.walk();t(l).each(function(){if(0===e.find(this.controller).size())throw Error("Rule's controller does not exist:"+this.controller);if(0===this.controls.length)throw Error("Rule has no controls:"+this);t(this.controls).each(function(){var n,i;if(0===(n=e,i=this,"#"==i[0]&&0>i.indexOf(" ")?t(i):n.find(i)))throw Error("Rule's target control "+this+" does not exist in context "+e.get(0));o++})}),i.log&&n("Controller check ok, rules count "+l.length+" controls count "+o)},install:function(n){t.deps.enable(t(document.body),this,n)}}),t.deps={createRuleset:function(){return new i},enable:function(t,e,i){((i=i||{}).checkTargets||void 0===i.checkTargets)&&e.checkTargets(t,i),i.log&&n("Enabling dependency change monitoring on "+t.get(0));var o=function(){e.applyRules(t,i)},l=t.on?t.on("change.deps",null,null,o):t.live("change.deps",o);return e.applyRules(t,i),l}}}(jQuery);